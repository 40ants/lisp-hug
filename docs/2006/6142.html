<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>RE: Callbacks from C threads into Lisp</title>
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>RE: Callbacks from C threads into Lisp</h1>
                <pre>
 

&gt -----Original Message-----
&gt From: owner-lisp-hug@lispworks.com 
&gt [mailto:owner-lisp-hug@lispworks.com] On Behalf Of John Pallister
&gt Sent: Friday, November 03, 2006 5:31 AM
&gt To: lisp-hug@lispworks.com
&gt Subject: Callbacks from C threads into Lisp
&gt 
&gt 
&gt I've coded up one of the sample C programs in Lisp using 
&gt fli:define-foreign-callable "stream-callback" and 
&gt fli:make-pointer :symbol-name "stream-callback", but when I 
&gt run it as an .EXE and the callback is called, I get:
&gt 
&gt    Failed to find stack-no 578 stack 1c8fe70
&gt    Stack dump
&gt    [16 lines of stack data]


Use sys:setup-for-alien-threads?

&gtFrom readme-5-0.pdf:

12.6.17 Foreign callbacks from unknown threads On Windows, Mac OS X, Linux and FreeBSD, foreign code can now call into Lisp in any thread, including those that LispWorks did not create.
On Windows the new function sys:setup-for-alien-threads sets up Lisp- Works to handle calls (via foreign callables) from "alien" threads, that is threads that LispWorks did not start. This setup happens automatically in LispWorks DLLs, but if there is a call into a LispWorks executable from an alien thread before sys:setup-for-alien-threads is called, the effect is unpredictable.



Eivind


</pre>
               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: Callbacks from C threads into Lisp</h1>
                 <pre>
Fantastic! Thanks for that, now it works. FWIW, some mention of this in the User
Guide (section 14.5.1, "Native threads on Windows, Mac OS X, Linux and FreeBSD"
specifically) would be very useful.

Saved from C++ yet again... phew!

Cheers,

John :^P

Eivind Midtg√•rd wrote:
&gt Use sys:setup-for-alien-threads?
--
John Pallister
john@synchromesh.com



</pre>
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-07 08:43 UTC
             </div>
            </footer>
           </body>
          </html>