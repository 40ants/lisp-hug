<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Manipulating and writing images</title>
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Manipulating and writing images</h1>
                <pre>
Hello list
    I need to plead for some help with the lw (windows) gp
functionality. I was writing a script to automate generation of
correctly sized images for my website at the weekend, it has to load
each image, create medium and thumbnail sized versions and write them
out to appropriate directories, nothing complicated. All the originals
are jpegs of about 2000x1000 in size although there are variations. At
this point I had to wrestle with the graphics ports api, a bit more
complex than really necessary I think but in the end I got
something. In pseudo code, for each image it does;

(let ((my-ext-image (gp:read-external-image an-image-path)))

    ;; later ...
    ;; I do the following twice, to two different ports with different scales

    (gp:draw-image port (gp:convert-external-image port my-ext-image) 0 0
        :transform (list scale 0 0 scale 0 0))

    ;; later ...
    ;; I do this twice also, once for each port, width and height I calculate myself

    (gp:write-external-image
        (gp:externalize-image port 
            (gp:make-image-from-port port 0 0 width height))
        output-image-path))

    Now, I have a couple of questions :)

    If the port is an output-pane the image appears correctly, I
actually use a pixmap-port in the code. In either case the image that
is written to disk is corrupted, it has various coloured lines
threaded through it.
    I note some mention of a way to get the bounds of an image after
is has been drawn and possibly transformed onto a port but I can't
seem to make this work. Is it available for images?
    I know nothing about image formats or colour management so I
expect I've just missed one of the various parameters to the image
manipulation functions, I hope someone has an idea

        thanks

            Andrew


</pre>
               </article>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-07 08:45 UTC
             </div>
            </footer>
           </body>
          </html>