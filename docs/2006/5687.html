<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>2 questions: make-list and hash-table</title>
            <meta name=viewport
                  content="width=device-width, initial-scale=1.0">
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>2 questions: make-list and hash-table</h1><HTML><BODY style="word-wrap: break-word; -khtml-nbsp-mode: space; -khtml-line-break: after-white-space; ">Hello,<DIV><BR class="khtml-block-placeholder"></DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Question 1:</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>when I create a list with like</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>(setf a (make-list 10 :initial-element '(0 0)))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>then the command</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>setf (second (nth 4 a)) 3)</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>creates var _a_ as</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>((0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>why does setf (second (nth 4 a)) 3) concern every nth in the sense of (first (second (nth x a)) ?</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Having read CLtL p. 418 (and Graham) I simply don't understand the situation.</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Question 2:</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>I try to figure out the details of the loop macro with hash-tables (I know of other possibilities but now I'm interested only in this).</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Some tutorials taught me that this works (and it does in LW):</DIV><UL><LI style="margin: 0.0px 0.0px 0.0px 0.0px"><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;">(setf h (make-hash-table))</SPAN></FONT></LI><LI style="margin: 0.0px 0.0px 0.0px 0.0px"><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;">(setf (gethash 'a h) 1)</SPAN></FONT></LI><LI style="margin: 0.0px 0.0px 0.0px 0.0px"><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;">(setf (gethash 'b h) 2)</SPAN></FONT></LI><LI style="margin: 0.0px 0.0px 0.0px 0.0px"><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;">loop for </SPAN></FONT><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px; text-decoration: underline;">k being the hash-key of h</SPAN></FONT><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;"> do (print k))</SPAN></FONT></LI></UL><DIV><BR class="khtml-block-placeholder"></DIV><DIV>But when I try to get the hash-val together with the key-val with</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;">(loop for </SPAN></FONT><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px; text-decoration: underline;">k being the hash-key using (hash-value v)</SPAN></FONT><FONT class="Apple-style-span" face="Courier" size="4"><SPAN class="Apple-style-span" style="font-size: 14px;"> of h do (format t "~a ~a~%" k v))</SPAN></FONT></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; ">then I get an error message from LW: Error: Unknown LOOP keyword in (... LOOP::OF H DO (FORMAT T "~a ~a~%" K V)).</DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; ">Having read the passages in CLtL p. 723 I can't find a solution (in the sense of a very similar formulation - not maphash or other loop-constructions).</DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; ">Many thanks for any advice.</DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; ">Best,</DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; ">Max</DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV><DIV style="text-indent: -36px;margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 36px; "><BR class="khtml-block-placeholder"></DIV></BODY></HTML>

               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: 2 questions: make-list and hash-table</h1>
                 <pre>
On Tue, 11 Jul 2006 20:50:57 +0200, Max Haas &lt;Max.Haas@unibas.ch&gt wrote:

&gt Question 1:
&gt
&gt when I create a list with like
&gt
&gt (setf a (make-list 10 :initial-element '(0 0)))
&gt
&gt then the command
&gt
&gt setf (second (nth 4 a)) 3)
&gt
&gt creates var _a_ as
&gt
&gt ((0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3))
&gt
&gt why does setf (second (nth 4 a)) 3) concern every nth in the sense
&gt of (first (second (nth x a)) ?
&gt
&gt Having read CLtL p. 418 (and Graham) I simply don't understand the
&gt situation.

You've initialized the list with 10 "pointers" (in the sense of
languages like C) to the /same/ literal '(0 0).  If you modify one of
them, you modify them all (because they're all the same).  Try

  (eq (first a) (second a))

What you want is something like this:

  (setq a (loop repeat 10 collect (list 0 0)))

&gt Question 2:
&gt
&gt I try to figure out the details of the loop macro with hash-tables (I
&gt know of other possibilities but now I'm interested only in this).
&gt
&gt Some tutorials taught me that this works (and it does in LW):
&gt (setf h (make-hash-table))
&gt (setf (gethash 'a h) 1)
&gt (setf (gethash 'b h) 2)
&gt loop for k being the hash-key of h do (print k))
&gt
&gt But when I try to get the hash-val together with the key-val with
&gt
&gt (loop for k being the hash-key using (hash-value v) of h do (format t
&gt "~a ~a~%" k v))
&gt
&gt then I get an error message from LW: Error: Unknown LOOP keyword in
&gt (... LOOP::OF H DO (FORMAT T "~a ~a~%" K V)).
&gt
&gt Having read the passages in CLtL p. 723 I can't find a solution (in
&gt the sense of a very similar formulation - not maphash or other loop-
&gt constructions).

You've got the syntax wrong.  Try this:

  (loop for k being the hash-keys of h
        using (hash-value v)
        do (format t "~a ~a~%" k v))

Cheers,
Edi.


</pre>
                </article>
               </section>
               <section class=tree>
                <article class=email>
                 <h1>Re: 2 questions: make-list and hash-table</h1>
                 <pre>

Max Haas &lt;Max.Haas@unibas.ch&gt writes:
&gt (setf a (make-list 10 :initial-element '(0 0)))
&gt (setf (second (nth 4 a)) 3)
&gt
&gt creates var _a_ as
&gt
&gt ((0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3))
&gt why does setf (second (nth 4 a)) 3) concern every nth 

Because make-list is using the same exact initial-element everytime,
not a copy.  That is, they are sharing the same list structure.  Maybe
using a named variable will make this a bit clearer:

(setf xx (list 0 0))
(setf aa (make-list 10 :initial-element xx))
xx =&gt (0 0)
(setf (second (nth 4 aa)) 3) =&gt 3
xx =&gt (0 3)
aa =&gt ((0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3))

Put it another way: The list is 10 pointers/references to the same
object.

Depending on what you want to do, you might choose a different
initialization method.

&gt I try to figure out the details of the loop macro with hash-tables

Sorry, I'm a LOOP know-nothing.

Cheers,
Chris Dean


</pre>
                </article>
               </section>
               <section class=tree>
                <article class=email>
                 <h1>Re: 2 questions: make-list and hash-table</h1>
                 <pre>
Max Haas wrote:
&gt Hello,
&gt
&gt
&gt Question 1:
&gt
&gt when I create a list with like
&gt
&gt (setf a (make-list 10 :initial-element '(0 0)))
&gt
&gt then the command
&gt
&gt setf (second (nth 4 a)) 3)
&gt
&gt creates var _a_ as
&gt
&gt ((0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3) (0 3))
&gt
&gt why does setf (second (nth 4 a)) 3) concern every nth in the sense of 
&gt (first (second (nth x a)) ?
&gt
&gt Having read CLtL p. 418 (and Graham) I simply don't understand the 
&gt situation.
&gt
&gt Question 2:
&gt
&gt I try to figure out the details of the loop macro with hash-tables (I 
&gt know of other possibilities but now I'm interested only in this).
&gt
&gt Some tutorials taught me that this works (and it does in LW):
&gt
&gt     * (setf h (make-hash-table))
&gt     * (setf (gethash 'a h) 1)
&gt     * (setf (gethash 'b h) 2)
&gt     * loop for k being the hash-key of h do (print k))
&gt
&gt
&gt But when I try to get the hash-val together with the key-val with
&gt
&gt (loop for k being the hash-key using (hash-value v) of h do (format t 
&gt "~a ~a~%" k v))
&gt
&gt then I get an error message from LW: Error: Unknown LOOP keyword in 
&gt (... LOOP::OF H DO (FORMAT T "~a ~a~%" K V)).
&gt
&gt Having read the passages in CLtL p. 723 I can't find a solution (in 
&gt the sense of a very similar formulation - not maphash or other 
&gt loop-constructions).
&gt
&gt Many thanks for any advice.
&gt
&gt Best,
&gt
&gt Max
&gt
&gt
The reason is that you are inserting _the same_ element in every place 
in your array; '(0 0) is a constant essentially.  If you want 
different-but-equal elements in your array, you'll need something along 
the lines of

(let ((size 10))
  (setf *a* (make-array size
                        :initial-contents (loop repeat size
                                                collect (list 0 0)))))

(Not tested, I don't have a running Lisp right now)

-Klaus.


</pre>
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-10 08:48 UTC
             </div>
            </footer>
           </body>
          </html>