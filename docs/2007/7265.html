<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Mailbox Reader Process?</title>
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Mailbox Reader Process?</h1><html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">Hi,
<div><br class="webkit-block-placeholder"></div><div>Does anyone know what the purpose is for the mailbox-reader-process? I get the impression that this may be left over from ancient legacy code. It is documented as a function in the MP section of the Lispworks Reference Manual, but no description of its use.</div><div><br class="webkit-block-placeholder"></div><div>There is a lock in each mailbox too, but I assume, perhaps incorrectly, that it is used to prevent conflicts between readers / writers on the internal queue, since each read or write manipulating the queue must occur atomically to keep the queue state consistent. But surely, the MP system isn't asked to switch to the reader process for reading from a mailbox... eh?</div><div><br class="webkit-block-placeholder"></div><div>David McClain</div><div><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Chief Technical Officer</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Refined Audiometrics Laboratory</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">4391 N. Camino Ferreo</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Tucson, AZÂ  85750</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">email: <a href="mailto:dbm@refined-audiometrics.com">dbm@refined-audiometrics.com</a></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">phone: 1.520.390.3995</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">web: <a href="http://www.refined-audiometrics.com">http://www.refined-audiometrics.com</a></div><br class="Apple-interchange-newline"></span><span></span></span></span></span></span> </div><br></body></html>

               </article>
               <section class=tree>
                <article class=email>
                 <h1>:local-buffer causes exception, :once doesn't</h1>
                 <pre>
I hope someone will be able to explain this. This is with LW 5.0.2.

In the following example, if I use :draw-pinboard-objects :once, it 
works fine, if I use :local-buffer, which I think I'd prefer, I get the 
following error:

Error: Exception C0000005 [flags 0] at 20FBBCC1 {inside #&lt;Function 
INVALIDATE-RECT 20FBBBA2&gt}
eax 77D4B5F5 ebx        1 ecx      306 edx   8E03D8
esp 215ADA34 ebp 215ADA48 esi       56 edi 20FE2C6F
   1 (abort) Return to level 0.
   2 Return to top loop level 0.

Type :b for backtrace, :c &lt;option number&gt to proceed,  or :? for other 
options

(capi:define-interface test-interface ()
   ((display-scale :accessor display-scale :initform 2))
   (:layouts
    (test-pb
     capi:pinboard-layout
     '()
     :accessor test-pb
     :background :white
;;; :local-buffer doesn't work - :once does work
     :draw-pinboard-objects :local-buffer
;    :draw-pinboard-objects :once
     :visible-min-width 300
     :visible-min-height 300)
    (main-layout
     capi:row-layout
     '(test-pb)))
   (:default-initargs
    :layout 'main-layout
    :best-height 300
    :best-width 300))

(defun test (d)
     (dotimes (i 10)
       (test-add-square (make-instance 'square :x (* 40 (1+ i)) :y 40) 
(test-pb d))))

(defun test-add-square (sq pinboard)
   (capi:manipulate-pinboard pinboard sq :add-top))

(defclass square (capi:pinboard-object)
   ((foreground :accessor foreground :initform nil :initarg :foreground))
   (:default-initargs
    :visible-min-width 30
    :visible-min-height 30))

(defmethod capi:draw-pinboard-object (pinboard (square square) &amp;key)
   (capi:with-geometry square
     (gp:draw-rectangle pinboard
                        capi:%x% capi:%y%
                          capi:%width%
                          capi:%height%)))

To try it do:
 &gt (setf d (capi:display (make-instance 'test-interface)))
 &gt (test d)

Mitch


</pre>
                </article>
               </section>
               <section class=tree>
                <article class=email>
                 <h1>Re: Mailbox Reader Process?</h1>
                 <pre>
Hello David,

| Does anyone know what the purpose is for the mailbox-reader-process? I
| get the impression that this may be left over from ancient legacy code.
| It is documented as a function in the MP section of the Lispworks
| Reference Manual, but no description of its use.

I believe that mailbox-reader-process is valuable for mail boxes created
explicitly. FWIW, I used to run reports in a dedicated process:

(defun ensure-reports-mailbox ()
  (unless %reports-mailbox%
    (setq %reports-mailbox% (mp:make-mailbox)))
  (unless (and (mp:process-alive-p (mp:mailbox-reader-process
                                                     %reports-mailbox%))
                    (equal (mp:process-name (mp:mailbox-reader-process
                                %reports-mailbox%))
                      #1="Reports runner"))
    (setf (mp:mailbox-reader-process %reports-mailbox%)
          (let ((mp:*process-initial-bindings*
                    (acons '*acroview-conversation* nil
                               mp:*process-initial-bindings*)))
            ;; Ensure per thread conversation handle
            (mp:process-run-function #1# (list :mailbox %reports-mailbox%)
                                     'reports-runner))))
  %reports-mailbox%)

And then

   (mp:mailbox-send (ensure-reports-mailbox) &lt;thing&gt)
--
Sincerely,
Dmitriy Ivanov
lisp.ystok.ru


</pre>
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-07 08:41 UTC
             </div>
            </footer>
           </body>
          </html>