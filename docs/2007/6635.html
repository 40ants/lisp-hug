<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Text display in graphics ports at arbitrary baseline angles?</title>
            <meta name=viewport
                  content="width=device-width, initial-scale=1.0">
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Text display in graphics ports at arbitrary baseline angles?</h1><HTML><BODY style="word-wrap: break-word; -khtml-nbsp-mode: space; -khtml-line-break: after-white-space; ">Hi,<DIV><BR class="khtml-block-placeholder"></DIV><DIV>I have a routine for printing the vertical axis labels of a 2-D graph sideways. That works fine on the screen, and in BMP images. But when attempting to print to a saved PDF file on Mac OS/X, the entire Lisp image bombs out with a raft of null ObjC pointers.</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Obviously, my technique of drawing text along a horizontal baseline in a "compatible" graphics port, extracting the image bits, transposing them, and then planting the rotated image back into the output graphics port, does not work properly for PDF ports. And even if it did, the magnified PDF displays wouldn't show nice smooth text glyphs, but rather it would show chunky bitmap images.</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Anyone have any ideas on how to make LW produce text along arbitrary baseline angles? Without resorting to this kludge of bitmap rotations?</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Code below is included for anyone that might find it useful anyway... I certainly do for the screen presentation of my graphs, but it won't work for PDF output...</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>Cheers,</DIV><DIV><BR><DIV> <SPAN class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><SPAN class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><SPAN class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><SPAN class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">David McClain</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Chief Technical Officer</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Refined Audiometrics Laboratory</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">4391 N. Camino Ferreo</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Tucson, AZ  85750</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><BR></DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">email: <A href="mailto:dbm@refined-audiometrics.com">dbm@refined-audiometrics.com</A></DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">phone: 1.520.390.3995</DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">web: <A href="http://www.refined-audiometrics.com">http://www.refined-audiometrics.com</A></DIV><DIV style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Skype: dbmcclain</DIV><BR class="Apple-interchange-newline"></SPAN><SPAN></SPAN></SPAN></SPAN></SPAN> </DIV>-------------------------------------------------------------------------------<BR></DIV><DIV>(defun draw-vert-string-x-y (pane string x y</DIV><DIV>                                  &amp;key</DIV><DIV>                                  (x-alignment :baseline)</DIV><DIV>                                  (y-alignment :left)</DIV><DIV>                                  font</DIV><DIV>                                  prev-bounds</DIV><DIV>                                  (margin 2)</DIV><DIV>                                  (color :black)</DIV><DIV>                                  (transparent t))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>  (multiple-value-bind (lf tp rt bt)</DIV><DIV>      (gp:get-string-extent pane string font)</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>    (let* ((wd (- rt lf -1))</DIV><DIV>           (ht (- bt tp -1))</DIV><DIV>           (dx (ecase x-alignment</DIV><DIV>                 (:top      0)</DIV><DIV>                 (:bottom   (- ht))</DIV><DIV>                 (:baseline tp)</DIV><DIV>                 (:center   (floor tp 2))</DIV><DIV>                 ))</DIV><DIV>           (dy (ecase y-alignment</DIV><DIV>                 (:right    0)</DIV><DIV>                 (:left     (- wd))</DIV><DIV>                 (:center   (- (floor wd 2)))</DIV><DIV>                 ))</DIV><DIV>           (new-bounds (list (+ y lf dy) (+ y rt dy))))</DIV><DIV>      </DIV><DIV>      (if (and prev-bounds</DIV><DIV>               (bounds-overlap-p (expand-bounds prev-bounds margin) new-bounds))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>          prev-bounds</DIV><DIV>        </DIV><DIV>        (gp:with-pixmap-graphics-port (ph pane wd ht</DIV><DIV>                                          :clear t)</DIV><DIV>          (gp:with-graphics-state</DIV><DIV>              (ph :foreground color)</DIV><DIV>            (gp:draw-string ph string</DIV><DIV>                            0 (- tp)</DIV><DIV>                            :font font</DIV><DIV>                            :block (not transparent)))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>          (with-image (pane (v-image #+:COCOA (gp:make-image pane ht wd)</DIV><DIV>                                     #+:WIN32 (gp:make-image pane ht wd :alpha nil)</DIV><DIV>                                     ))</DIV><DIV>             (with-image (ph (h-image (gp:make-image-from-port ph)))</DIV><DIV>                 (with-image-access (ha (gp:make-image-access ph h-image))</DIV><DIV>                    (with-image-access (va (gp:make-image-access pane v-image))</DIV><DIV>                      (gp:image-access-transfer-from-image ha)</DIV><DIV>                      (loop for ix from 0 below wd do</DIV><DIV>                            (loop for iy from 0 below ht do</DIV><DIV>                                  (setf (gp:image-access-pixel va iy (- wd ix 1))</DIV><DIV>                                        (gp:image-access-pixel ha ix iy))</DIV><DIV>                                  ))</DIV><DIV>                      (gp:image-access-transfer-to-image va)</DIV><DIV>                      )))</DIV><DIV>             (gp:draw-image pane v-image (+ x dx) (+ y dy)))</DIV><DIV>          new-bounds</DIV><DIV>          ))</DIV><DIV>      )))</DIV><DIV><BR class="khtml-block-placeholder"></DIV><DIV>------------------------------------------------------------------------------</DIV></BODY></HTML>

               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: Text display in graphics ports at arbitrary baseline angles?</h1>
                 <pre>
Hi David!

&gt Obviously, my technique of drawing text along a horizontal baseline
&gt in a "compatible" graphics port, extracting the image bits,
&gt transposing them, and then planting the rotated image back into the
&gt output graphics port, does not work properly for PDF ports. And even
&gt if it did, the magnified PDF displays wouldn't show nice smooth text
&gt glyphs, but rather it would show chunky bitmap images.
&gt
&gt Anyone have any ideas on how to make LW produce text along arbitrary
&gt baseline angles? Without resorting to this kludge of bitmap rotations?

This has been discussed a couple of times before (see
http://thread.gmane.org/gmane.lisp.lispworks.general/1730 and
http://article.gmane.org/gmane.lisp.lispworks.general/6433).

I don't think there is a nice kludge-less solution for this problem
without access to the CAPI implementation.  Maybe burning a few
Lispworks support calls will help...

&gt Code below is included for anyone that might find it useful anyway...

Thanks.  You may want to compare it with the code I posted in 2003
(see the attachment at http://thread.gmane.org/gmane.lisp.lispworks.general/1730).

Arthur


</pre>
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-10 08:46 UTC
             </div>
            </footer>
           </body>
          </html>