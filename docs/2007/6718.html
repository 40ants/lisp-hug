<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>delivered images and shared libraries (clsql) on linux</title>
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>delivered images and shared libraries (clsql) on linux</h1>
                <pre>
Hi,
I have some problems loading using clsql_uffi.so on linux, any help is
appreciated

I have two machines, development:

Linux valad 2.6.15-28-amd64-generic #1 SMP PREEMPT Tue Mar 13 20:51:52
UTC 2007 x86_64 GNU/Linux

and production:

Linux lin 2.6.15-28-amd64-server #1 SMP Thu May 10 09:58:22 UTC 2007
x86_64 GNU/Linux

I have a delivered LWL 5.0.2 image that uses clsql and sqlite3. It
works fine on my development machine, but bombs out on my production
machine. I copied over the clsql_uffi directory from my development
machine to get to the shared libraries.

The reason I suspect that clsql is involved is that a earlier version
of the image that did not use clsql worked fine (Not just the
inclusion of the package has changed, of course.) The image also
crashes fairly soon after loading the shared library. (see below.) On
my development machine the next system call is vfork().

....
open("/home/asbjxrn/lispworks/packages/clsql-3.7.7/uffi/clsql_uffi.so",
O_RDONLY) = 3
read(3, "\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\374\1\0"..., 512) = 512
fstat64(0x3, 0xffffcea4)                = 0
mmap2(NULL, 4988, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3,
0) = 0x5556e000
mmap2(0x5556f000, 4096, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0) = 0x5556f000
close(3)                                = 0
geteuid32()                             = 1000
stat64(0xffffd520, 0x20088248)          = 0
getegid32()                             = 1000
getgroups32(32, [4, 20, 24, 25, 29, 30, 44, 46, 106, 107, 108, 1000]) = 12
socketpair(PF_FILE, 0 /* SOCK_??? */, 2338162930173870084ptrace:
umoven: Input/output error
, [...]) = 0
getrlimit(RLIMIT_NOFILE, {rlim_cur=4294967297*1024,
rlim_max=2319649199307176419}) = 0
--- SIGSEGV (Segmentation fault) @ 0 (0) ---
+++ killed by SIGSEGV +++

-- 
  -asbjxrn


</pre>
               </article>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-07 08:42 UTC
             </div>
            </footer>
           </body>
          </html>