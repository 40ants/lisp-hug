<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Item in tree-view pane-menu callbacks on Linux and tree-view state image 
             lists</title>
            <meta name=viewport
                  content="width=device-width, initial-scale=1.0">
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Item in tree-view pane-menu callbacks on Linux and tree-view state image 
                 lists</h1><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=iso-8859-1"><meta name=Generator content="Microsoft Word 15 (filtered medium)"><style><!--
/* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-fareast-language:EN-US;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:#954F72;
	text-decoration:underline;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-fareast-language:EN-US;}
span.E-MailFormatvorlage17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
..MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;
	mso-fareast-language:EN-US;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:70.85pt 70.85pt 2.0cm 70.85pt;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:1603142247;
	mso-list-type:hybrid;
	mso-list-template-ids:-1442432708 -14285352 67567619 67567621 67567617 67567619 67567621 67567617 67567619 67567621;}
@list l0:level1
	{mso-level-start-at:0;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Calibri",sans-serif;
	mso-fareast-font-family:Calibri;}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l0:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Wingdings;}
@list l0:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level5
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l0:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Wingdings;}
@list l0:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level8
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l0:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Wingdings;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext="edit" spidmax="1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext="edit">
<o:idmap v:ext="edit" data="1" />
</o:shapelayout></xml><![endif]--></head><body lang=DE link="#0563C1" vlink="#954F72"><div class=WordSection1><p class=MsoNormal>Hi everyone,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US>I&#8217;m porting a largish CAPI code-base from Windows MDI to Linux using LispWorks 7.1.1, which has gone surprisingly well so far (so a big kudos to LispWorks for their nice CAPI).<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US>However I&#8217;ve run across two issues related to capi:tree-view, where I&#8217;ve not found something enlightening in the docs and this mailing list: <o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><ul style='margin-top:0cm' type=disc><li class=MsoListParagraph style='margin-left:0cm;mso-list:l0 level1 lfo1'><span lang=EN-US>On Windows the pane-menu callback is passed the proper item that the user clicked on; however on Linux/GTK it seems that the item is always nil and there does not seem to be a good way to work-around this (other than switching to using the current selection, which is however updated too late in the callback sequence, or hand-calculating the item from the coordinates). Is this a known limitation/problem, or am I just missing something? The docs do not seem to suggest a difference in behavior here?<o:p></o:p></span></li><li class=MsoListParagraph style='margin-left:0cm;mso-list:l0 level1 lfo1'><span lang=EN-US>On Windows when using :use-state-images, I need to pass in an :image-lists argument specifying both :normal and :state image-lists, which are respectively used for image and state images. On Linux it seems that the display indexes into the :normal image-list even for the indices returned by :state-image-function; however it does seem to check those indices against the size of the :state image-list, so maybe this is just a bug? Or is this an expected deviation? I.e. the following code seems to work OK on Windows, but shows the wrong state images (using ones from :normal) on Linux/GTK:<o:p></o:p></span></li></ul><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US>    :use-images t<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>    :use-state-images t<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>    :image-lists (list :normal (get-image-list 'fmu-tree #P&quot;fmu-tree.bmp&quot; 20 16 16)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                       :state (get-image-list 'fmu-tree-state #P&quot;fmu-tree-state.bmp&quot; 3 16 16))<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>    :image-function #'ui-item-image-index<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>    :state-image-function #'(lambda (item) (if (atom item)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                               (if (typep item 'fmu-variable-instance)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                                   (if (fmu-variable-instance-exposed-as item)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                                       2<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                                     1)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                                 0)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US>                                             0))<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US>Can anyone give any pointers on these two issues, or is there agreement that one or both are just bugs? Thanks,<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US>Regs, Pierre.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>-- <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>Pierre R. Mai&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="mailto:pmai@pmsf.de"><span style='color:blue'>&lt;pmai@pmsf.de&gt;</span></a><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>PMSF IT Consulting Pierre R. Mai&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'><a href="http://www.pmsf.de/"><span lang=EN-US style='color:blue'>http://www.pmsf.de/</span></a></span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>Blumenstr. 4&nbsp;/ Büro Waldweg 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Goethestr. 32<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>85417 Marzling&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 87724 Ottobeuren<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>Tel. +49(0)8161/976 96 - 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +49(0)8332/936 69 13<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>Fax&nbsp; +49(0)8161/976 96 - 51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +49(0)8332/936 69 03<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;mso-fareast-language:DE'>Germany&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VAT ID / USt-ID Nr: DE 212838159<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p></div></body></html>

               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: Item in tree-view pane-menu callbacks on Linux and tree-view state image 
                  lists</h1>
                 <pre>Yes, the pane-menu callback is always called with nil to GTK.  I'm not sure if
that is a bug or not, but I don't see any problem with using
capi:choice-selected-item in the function (LispWorks does this in the Debugger
backtrace to show a different menu for functions and variables).

The problem with state images is a bug that we will fix.

-- 
Martin Simmons
LispWorks Ltd
http://www.lispworks.com/


&gt&gt&gt&gt&gt On Mon, 13 Aug 2018 14:31:00 +0200, Pierre R Mai said:
&gt 
&gt Hi everyone,
&gt 
&gt I'm porting a largish CAPI code-base from Windows MDI to Linux using
&gt LispWorks 7.1.1, which has gone surprisingly well so far (so a big kudos to
&gt LispWorks for their nice CAPI).
&gt 
&gt However I've run across two issues related to capi:tree-view, where I've not
&gt found something enlightening in the docs and this mailing list: 
&gt 
&gt *	On Windows the pane-menu callback is passed the proper item that the
&gt user clicked on; however on Linux/GTK it seems that the item is always nil
&gt and there does not seem to be a good way to work-around this (other than
&gt switching to using the current selection, which is however updated too late
&gt in the callback sequence, or hand-calculating the item from the
&gt coordinates). Is this a known limitation/problem, or am I just missing
&gt something? The docs do not seem to suggest a difference in behavior here?
&gt 
&gt *	On Windows when using :use-state-images, I need to pass in an
&gt :image-lists argument specifying both :normal and :state image-lists, which
&gt are respectively used for image and state images. On Linux it seems that the
&gt display indexes into the :normal image-list even for the indices returned by
&gt :state-image-function; however it does seem to check those indices against
&gt the size of the :state image-list, so maybe this is just a bug? Or is this
&gt an expected deviation? I.e. the following code seems to work OK on Windows,
&gt but shows the wrong state images (using ones from :normal) on Linux/GTK:
&gt 
&gt  
&gt 
&gt     :use-images t
&gt     :use-state-images t
&gt     :image-lists (list :normal (get-image-list 'fmu-tree #P"fmu-tree.bmp" 20 16 16)
&gt                        :state (get-image-list 'fmu-tree-state #P"fmu-tree-state.bmp" 3 16 16))
&gt     :image-function #'ui-item-image-index
&gt     :state-image-function #'(lambda (item) (if (atom item)
&gt                                                (if (typep item 'fmu-variable-instance)
&gt                                                    (if (fmu-variable-instance-exposed-as item)
&gt                                                        2
&gt                                                      1)
&gt                                                  0)
&gt                                              0))
&gt 
&gt Can anyone give any pointers on these two issues, or is there agreement that
&gt one or both are just bugs? Thanks,
&gt 
&gt Regs, Pierre.
&gt 
&gt  
&gt 
&gt -- 
&gt Pierre R. Mai                                         &lt;pmai@pmsf.de&gt
&gt PMSF IT Consulting Pierre R. Mai                 http://www.pmsf.de/
&gt Blumenstr. 4 / Büro Waldweg 4                         Goethestr. 32
&gt 85417 Marzling                                     87724 Ottobeuren
&gt Tel. +49(0)8161/976 96 - 11                    +49(0)8332/936 69 13
&gt Fax  +49(0)8161/976 96 - 51                    +49(0)8332/936 69 03
&gt Germany                            VAT ID / USt-ID Nr: DE 212838159

_______________________________________________
Lisp Hug - the mailing list for LispWorks users
lisp-hug@lispworks.com
http://www.lispworks.com/support/lisp-hug.html

</pre>
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-10 08:29 UTC
             </div>
            </footer>
           </body>
          </html>