<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Is MIDL facility broken?</title>
            <meta name=viewport
                  content="width=device-width, initial-scale=1.0">
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Is MIDL facility broken?</h1>
<html>
<head>
<meta name="generator" content="Windows Mail 17.5.9600.20279">
<style data-externalstyle="true"><!--
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph {
margin-top:0in;
margin-right:0in;
margin-bottom:0in;
margin-left:.5in;
margin-bottom:.0001pt;
}
p.MsoNormal, li.MsoNormal, div.MsoNormal {
margin:0in;
margin-bottom:.0001pt;
}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst, 
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle, 
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast {
margin-top:0in;
margin-right:0in;
margin-bottom:0in;
margin-left:.5in;
margin-bottom:.0001pt;
line-height:115%;
}
--></style></head>
<body dir="ltr">
<div data-externalstyle="false" dir="ltr" style="font-family: 'Calibri', 'Segoe UI', 'Meiryo', 'Microsoft YaHei UI', 'Microsoft JhengHei UI', 'Malgun Gothic', 'sans-serif';font-size:12pt;">



<div>Hello all,<br><br>I tried MIDL on ShObjIdl.idl file recently and it does not go well at all<br>Which is very frustrating.<br>Please see partial output below.<br>Do we have workaround for this? I want to implement interface which is listed in ShObjIdl.idl <br><br>Midl.exe report following:<br><br>Microsoft (R) 32b/64b MIDL Compiler Version 8.00.0595<br>Copyright (c) Microsoft Corporation. All rights reserved.<br><br><br>PS<br>I specifically interested in IContextMenu, IShellExtInit (which it parses at least) and couple other interfaces but I could not get them all neither with MIDL nor with DEFSYSTEMs :MIDL-TYPE-LIBRARY-FILE options<br><br><br>CL-USER&gt; (com:midl "C:\\Program Files (x86)\\Windows Kits\\8.0\\include\\um\\ShObjIdl.idl" :output-file t)<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\ShObjIdl.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\objidl.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\unknwn.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\shared\wtypes.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\shared\wtypesbase.idl<br><br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:114]: Unexpected symbol "annotation"<br>Skipping rest of statement.<br>Discarding symbols: ";" "ULONG" "AddRef" "(" ")" ";" "ULONG" "Release" "(" ")" ";" "}" "cpp_quote" "(" "#endif" ")" "cpp_quote" "(" "#endif /* WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP) */" ")" "cpp_quote" "(" "#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)" ")"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:137]: Unexpected symbol "annotation"<br>Skipping rest of statement.<br>Discarding symbols: ";" "HRESULT" "Begin_AddRef" "(" ")" ";" "ULONG" "Finish_AddRef" "(" ")" ";" "HRESULT" "Begin_Release" "(" ")" ";" "ULONG" "Finish_Release" "(" ")" ";" "}" "cpp_quote" "(" "#endif /* WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP) */" ")" "cpp_quote" "(" "#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP)" ")"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:165]: Unexpected symbol "annotation"<br>Skipping rest of statement.<br>Discarding symbols: ";"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:170]: Unexpected symbol "HRESULT"<br>Skipping rest of statement.<br>Discarding symbols: ";"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:175]: Unexpected symbol "HRESULT"<br>Skipping rest of statement.<br>Discarding symbols: ";"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:179]: Unexpected symbol "HRESULT"<br>Skipping rest of statement.<br>Discarding symbols: ";" "}"<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\objidlbase.idl:115]: Unexpected symbol "annotation"<br>Skipping rest of statement.<br>Discarding symbols: ";" "HRESULT" "GetMarshalSizeMax" "("<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\objidlbase.idl:125]: Unexpected symbol "annotation"<br></div><div data-signatureblock="true"><div><br></div><div>Sent from Windows Mail</div><div><br></div></div>











</div>
</body>
</html>

               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: Is MIDL facility broken?</h1><div dir="ltr"><div><div>For records I was able to get on with this snippet <br><br></div>(lets see how far it will take me)<br><br></div>At least dummy D-C-I works <br><br>&gt; (com:define-com-implementation my-ext ()<br>
                                           ()<br>                                           (:interfaces i-shell-ext-init i-context-menu))<br><div><div><br><pre>import &quot;unknwn.idl&quot;;
import &quot;wtypes.idl&quot;;
import &quot;objidl.idl&quot;;
import &quot;shtypes.idl&quot;;
[
    uuid(000214E8-0000-0000-C000-000000000046),
    object,
    local,
    pointer_default(unique)
]
interface IShellExtInit : IUnknown
{
    HRESULT Initialize(
        [in] PCIDLIST_ABSOLUTE pidlFolder,
        [in] IDataObject *pdtobj,
        [in] HKEY hkeyProgID);
}

//NOTE: When SEE_MASK_HMONITOR is set, hIcon is treated as hMonitor
typedef struct _CMINVOKECOMMANDINFO
{
    DWORD cbSize;        // sizeof(CMINVOKECOMMANDINFO)
    DWORD fMask;         // any combination of CMIC_MASK_*
    HWND hwnd;           // might be NULL (indicating no owner window)
    LPCSTR lpVerb;       // either a string or MAKEINTRESOURCE(idOffset)
    LPCSTR lpParameters; // might be NULL (indicating no parameter)
    LPCSTR lpDirectory;  // might be NULL (indicating no specific directory)
    int nShow;           // one of SW_ values for ShowWindow() API
    DWORD dwHotKey;
    HANDLE hIcon;
} CMINVOKECOMMANDINFO;

// IContextMenu
[
    local,
    uuid(000214e4-0000-0000-c000-000000000046), // IID_IContextMenu
    pointer_default(unique),
]
interface IContextMenu : IUnknown
{
    HRESULT QueryContextMenu(
        [in] HMENU hmenu,
        [in] UINT indexMenu,
        [in] UINT idCmdFirst,
        [in] UINT idCmdLast,
        [in] UINT uFlags);

    HRESULT InvokeCommand([in] CMINVOKECOMMANDINFO *pici);

    HRESULT GetCommandString(
        [in] UINT_PTR idCmd,
        [in] UINT uType,
        [in] UINT * pReserved,
        [out] LPSTR pszName,
        [in] UINT cchMax);
}

typedef IContextMenu *LPCONTEXTMENU;
</pre><br></div></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Wed, Oct 23, 2013 at 7:17 PM,  <span dir="ltr">&lt;<a href="mailto:yakov@clickgrab.net" target="_blank">yakov@clickgrab.net</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">




<div dir="ltr">
<div dir="ltr" style="font-family:&#39;Calibri&#39;,&#39;Segoe UI&#39;,&#39;Meiryo&#39;,&#39;Microsoft YaHei UI&#39;,&#39;Microsoft JhengHei UI&#39;,&#39;Malgun Gothic&#39;,&#39;sans-serif&#39;;font-size:12pt">



<div>Hello all,<br><br>I tried MIDL on ShObjIdl.idl file recently and it does not go well at all<br>Which is very frustrating.<br>Please see partial output below.<br>Do we have workaround for this? I want to implement interface which is listed in ShObjIdl.idl <br>
<br>Midl.exe report following:<br><br>Microsoft (R) 32b/64b MIDL Compiler Version 8.00.0595<br>Copyright (c) Microsoft Corporation. All rights reserved.<br><br><br>PS<br>I specifically interested in IContextMenu, IShellExtInit (which it parses at least) and couple other interfaces but I could not get them all neither with MIDL nor with DEFSYSTEMs :MIDL-TYPE-LIBRARY-FILE options<br>
<br><br>CL-USER&gt; (com:midl &quot;C:\\Program Files (x86)\\Windows Kits\\8.0\\include\\um\\ShObjIdl.idl&quot; :output-file t)<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\ShObjIdl.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\objidl.idl<br>
;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\um\unknwn.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\shared\wtypes.idl<br>;;; Processing C:\Program Files (x86)\Windows Kits\8.0\include\shared\wtypesbase.idl<br>
<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:114]: Unexpected symbol &quot;annotation&quot;<br>Skipping rest of statement.<br>Discarding symbols: &quot;;&quot; &quot;ULONG&quot; &quot;AddRef&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;ULONG&quot; &quot;Release&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;}&quot; &quot;cpp_quote&quot; &quot;(&quot; &quot;#endif&quot; &quot;)&quot; &quot;cpp_quote&quot; &quot;(&quot; &quot;#endif /* WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP) */&quot; &quot;)&quot; &quot;cpp_quote&quot; &quot;(&quot; &quot;#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)&quot; &quot;)&quot;<br>
Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:137]: Unexpected symbol &quot;annotation&quot;<br>Skipping rest of statement..<br>Discarding symbols: &quot;;&quot; &quot;HRESULT&quot; &quot;Begin_AddRef&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;ULONG&quot; &quot;Finish_AddRef&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;HRESULT&quot; &quot;Begin_Release&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;ULONG&quot; &quot;Finish_Release&quot; &quot;(&quot; &quot;)&quot; &quot;;&quot; &quot;}&quot; &quot;cpp_quote&quot; &quot;(&quot; &quot;#endif /* WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP) */&quot; &quot;)&quot; &quot;cpp_quote&quot; &quot;(&quot; &quot;#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP)&quot; &quot;)&quot;<br>
Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:165]: Unexpected symbol &quot;annotation&quot;<br>Skipping rest of statement..<br>Discarding symbols: &quot;;&quot;<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:170]: Unexpected symbol &quot;HRESULT&quot;<br>
Skipping rest of statement.<br>Discarding symbols: &quot;;&quot;<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:175]: Unexpected symbol &quot;HRESULT&quot;<br>Skipping rest of statement.<br>Discarding symbols: &quot;;&quot;<br>
Error: [c:\program files (x86)\windows kits\8.0\include\um\unknwnbase.idl:179]: Unexpected symbol &quot;HRESULT&quot;<br>Skipping rest of statement.<br>Discarding symbols: &quot;;&quot; &quot;}&quot;<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\objidlbase.idl:115]: Unexpected symbol &quot;annotation&quot;<br>
Skipping rest of statement.<br>Discarding symbols: &quot;;&quot; &quot;HRESULT&quot; &quot;GetMarshalSizeMax&quot; &quot;(&quot;<br>Error: [c:\program files (x86)\windows kits\8.0\include\um\objidlbase.idl:125]: Unexpected symbol &quot;annotation&quot;<br>
</div><div><div><br></div><div>Sent from Windows Mail</div><div><br></div></div>











</div>
</div>

</blockquote></div><br><br clear="all"><br>-- <br>Yakov Zaytsev<br>+7 921 343 4327 (Russia)
</div>


                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-10 08:34 UTC
             </div>
            </footer>
           </body>
          </html>