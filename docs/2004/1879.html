<!DOCTYPE html>
<html lang=en>
           <head>
            <meta charset=UTF-8>
            <title>Saving and loading big objects (or: limits for FASL files)</title>
            <meta name=viewport
                  content="width=device-width, initial-scale=1.0">
            <link rel=stylesheet
                  href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css
                  integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2
                  crossorigin=anonymous>
            <style>
section.tree {
    padding-left: 2em;
}
section.tree:first-child {
    padding-left: 0;
}
.article-link {
  margin-bottom: 1em;
}
</style>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3G9MMWZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9X3G9MMWZP');
</script>

           </head>
           <body>
            <header class="d-flex justify-content-center">
             <nav
                  class="navbar navbar-light bg-light w-100 mx-5 mb-3">
              <a class=navbar-brand href="/">Lisp HUG Maillist Archive</a>
             </nav>
            </header>
            <div class="d-flex justify-content-center">
             <div class="w-100 mx-5 px-3">
              <section class=tree>
               <article class=email>
                <h1>Saving and loading big objects (or: limits for FASL files)</h1>
                <pre>Hi,

I'm dumping some pretty big objects to FASL files by writing some
MAKE-LOAD-FORM methods and calling HCL:DUMP-FORMS-TO-FILE.

This works pretty well, but when the objects get very big (and the
resulting FASL files are somewhere between 5 and 10 MB), I get the
following error when I try to LOAD the FASL file:

  Error: Array size 2216391 is not an integer in the legal range 0 to 2096895.
    1 (continue) Try loading d:\frank\lisp\fflip\simulation-11200.fsl again.
    2 Give up loading d:\frank\lisp\fflip\simulation-11200.fsl.
    3 Try loading another file instead of d:\frank\lisp\fflip\simulation-11200.fsl.
    4 (abort) Return to level 0.
    5 Return to top loop level 0.

I need to save and load objects that are about 5 times bigger than the size
at which this error occurs, so I'm looking for solutions around this problem.

Some options I'm thinking about are:

 - Fine-tuning my MAKE-LOAD-FORM methods.
   I suppose I could optimize the forms that are generated by my MAKE-LOAD-FORM
   methods. At the moment, I mostly just call MAKE-LOAD-FORM-SAVING-SLOTS, which
   generates safe but rather long load-forms.
   With some work, I expect I may be able to gain a factor 2, but I doubt that
   I can get the factor 5 that I need.

 - Don't use HCL:DUMP-FORMS-TO-FILE, but just use WRITE to write the load-forms
   to a file. I suppose this will mean that loading the file will take a lot
   longer. And I'm not sure that this will actually solve the limitation problem.

 - Define my own file format and write my own reader/loader.
   That's always possible as a last resort, but I hope that won't be necessary.

All suggestions appreciated.

Thanks in advance,

Arthur Lemmens


</pre>
               </article>
               <section class=tree>
                <article class=email>
                 <h1>Re: Saving and loading big objects (or: limits for FASL files)</h1>
                 <p>
                  Unable to parse email body. Email id is 1880
                </article>
               </section>
               <section class=tree>
                <article class=email>
                 <h1>Re: Saving and loading big objects (or: limits for FASL files)</h1>
                 <pre>On Thu, 12 Feb 2004 12:43:32 GMT, Nick Levine &lt;ndl@ravenbrook.com&gt wrote:

&gt In my case, becuase the structures I was dumping had very few
&gt pointers, it was very easy to write by own reader/loader - less than
&gt a day I think. It now runs an order of magnitude faster, and the
&gt files thus generated are not only much smaller but also will work
&gt for future versions of LW plus other platforms, which may turn out
&gt to be handy.

Do you mean a reader/loader that reads/loads a binary format specific
to your structures? Would you mind to sketch in a few sentences how it
worked and how you managed to make it much faster than
FASL-reading/loading?

Thanks in advance,
Edi.


</pre>
                </article>
               </section>
               <section class=tree>
                <article class=email>
                 <h1>Re: Saving and loading big objects (or: limits for FASL files)</h1>
                 <p>
                  Unable to parse email body. Email id is 1884
                </article>
               </section>
              </section>
             </div>
            </div>
            <footer class="d-flex justify-content-center">
             <div>
              Updated at: 2020-12-10 08:57 UTC
             </div>
            </footer>
           </body>
          </html>